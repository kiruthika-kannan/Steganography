
# coding: utf-8

# In[31]:


import numpy as np
import cv2

img = cv2.imread('../input/mandril_color.tif',cv2.IMREAD_GRAYSCALE)
rows , cols = img.shape
img_copy = img.copy()
#print(img)
secret = 31

secret_text = ['fly','high' ]
asciival = []
asciival = [ord(ch) for word in secret_text for ch in word]

secret_arr = np.array(asciival)
print('ascii value of secret data', secret_arr)

print('length of secret data', len(secret_arr))
s_len= len(secret_arr)
print(l)
n =4

smod = secret%(2*n+1)
a,b = divmod(secret, 2*n+1)
print(a,b)


# In[29]:


def emd_embedding(image):
    femdsum = 0
    t=0
    for i in range(0,rows-1,n):
            for j in range(0,cols-1,n):
                t = t+1
                if (t<=s_len):
                    p = 0
                    blk = image[i:i+n,j:j+n]
                    for k in range(0,n):
                        for l in range(0,n):
                            p = p+1
                            femdsum = femdsum + blk[k,l]*p
                    femd =  femdsum%(2*n+1)     
                    print('femd',femd)
                    d = (smod - femd)%(2*n+1)
                    #print(d)
                    if (d == 0):
                        image[i:i+n,j:j+n] = blk
                    elif (d <=n):
                        u,v  = divmod(d, n)
                        blk[u,v] = blk[u,v] +1
                        image[i:i+n,j:j+n] = blk
                    else:
                        d_prime = 2*n+1-d
                        u,v =  divmod(d_prime, n)
                        blk[u,v] = blk[u,v] -1
                        image[i:i+n,j:j+n] = blk


    cv2.imwrite("../output/Stego.tif",img_copy)

                
                
                #print(u,v,d)
                
                    
            
           # print(blk)


# In[30]:


# print(2*n+1)
# print ((1-5)%7)
emd_embedding(img_copy)


# In[38]:


img_stego = cv2.imread('../output/Stego.tif',cv2.IMREAD_GRAYSCALE)
rows1 , cols1 = img_stego.shape
smod_ex = 0

def emd_extraction(image):
    t=0
    femdsum_ex = 0
    for i in range(0,rows1-1,n):
        for j in range(0,cols1-1,n):
            t = t+1
            if (t<=s_len):
                p = 0
                blk = image[i:i+n,j:j+n]
                for k in range(0,n):
                    for l in range(0,n):
                        p = p+1
                        femdsum_ex = femdsum_ex + blk[k,l]*p
                femd =  femdsum_ex%(2*n+1)     
                smod_ex = femd
                
                print('mod value of  secret ascii with (2n+1)', smod_ex)
    
    


# In[39]:


emd_extraction(img_stego)

